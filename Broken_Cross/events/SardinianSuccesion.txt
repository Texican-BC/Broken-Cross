# Usually should result in the destruction of Sardinia, and either the rise of the Knights or Siqily
namespace = sardinian_succession
country_event = {
	id = sardinian_succession.1
	title = "sardinian_succession.1.t"
	desc = "sardinian_succession.1.d"
	picture = KING_SICK_IN_BED_eventPicture
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 1
	}
	
	trigger = {
		tag = SAR
		has_ruler = "Guglielmo I"
	}
	
	option = { # We don't need them (Make sure to warn the player that there'll be trouble if no heir appears)
		name = "sardinian_succession.1.a"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 3
				has_heir = yes
			}
			modifier = {
				factor = 0
				allied_with = KNI
			}
		}
		KNI = {	country_event = { id = sardinian_succession.2 days = 3 } }
		SQL = { country_event = { id = sardinian_succession.4 days = 5 } }
		add_prestige = 5
	}
	
	option = { # Seek protection from the Knights
		name = "sardinian_succession.1.b"
		ai_chance = { factor = 90 }
		KNI = { country_event =  { id = sardinian_succession.3 days = 3 } }
		SQL = { country_event = { id = sardinian_succession.4 days = 5 } }
		add_prestige = -5
	}
}

country_event = { # Sardinians refuse us
	id = sardinian_succession.2
	title = "sardinian_succession.2.t"
	desc = "sardinian_succession.2.d"
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	
	option = { # Acknowledge their sovereignty
		name = "sardinian_succession.2.a"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				ruler_has_personality = just_personality
			}
		}
		add_prestige = -5
	}
	
	option = { # Prepare to seize the island
		name = "sardinian_succession.2.b"
		ai_chance = { factor = 90 }
		corsica_sardinia_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_claim = ROOT
		}
		add_opinion = {
			who = SAR
			modifier = border_friction_from_event
		}
		reverse_add_opinoin = {
			who = SAR
			modifier = border_friction_from_event
		}
	}
}

country_event = { # Sardinians come seeking aid
	id = sardinian_succession.3
	title = "sardinian_succession.3.t"
	desc = "sardinian_succession.3.d"
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	
	option = { # Give them protection
		name = "sardinian_succession.3.a"
		ai_chance = { factor = 95 }
		add_historical_friend = SAR
		SAR = { add_historical_friend = KNI set_country_flag = got_kni_protection }
		create_alliance = SAR
	}
	
	option = { # Why? It's a dead state walking
		name = "sardinian_succession.3.b"
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0
				ruler_has_personality = just_personality
			}
			modifier = {
				factor = 5
				ruler_has_personality = greedy_personality
			}
			modifier = {
				factor = 0
				allied_with = SAR
			}
		}
		corsica_sardinia_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_claim = ROOT
		}
		add_devotion = -10
		SAR = {	country_event = { id = sardinian_succession.5 } }
	}
}

country_event = { # Notification for player that there will be an event war, and provide background information
	id = sardinian_succession.4
	title = "sardinian_succession.4.t"
	desc = "sardinian_succession.4.d"
	picture = BORDER_TENSION_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "sardinian_succession.4.a"
		corsica_sardinia_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
				NOT = { province_id = 1247 }
			}
			add_claim = ROOT
		}
	}
}

country_event = { # Notification for player that the knights have refused, maybe add an option for Sardinia to seek another country's protection
	id = sardinian_succession.5
	title = "sardinian_succession.5.t"
	desc = "sardinian_succession.5.d"
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "sardinian_succession.5.a"
	}
}

country_event = { # The death of Guglielmo
	id = sardinian_succession.6
	title = "sardinian_succession.6.t"
	desc = {
		trigger = { has_heir = no NOT = { has_country_flag = got_kni_protection } }
		desc ="sardinian_succession.6.d1"
	}
	desc = {
		trigger = { has_heir = yes NOT = { has_country_flag = got_kni_protection } }
		desc ="sardinian_succession.6.d2"
	}
	desc = {
		trigger = { has_country_flag = got_kni_protection }
		desc ="sardinian_succession.6.d3"
	}
	picture = KING_SICK_IN_BED_eventPicture
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		tag = SAR
	}
	
	option = { # Stood Alone
		name = "sardinian_succession.6.a"
		trigger = { NOT = { has_country_flag = got_kni_protection } }
		KNI = {	country_event = { id = sardinian_succession.7 } }
		SQL = { country_event = { id = sardinian_succession.8 } }
		if = { # Test this to make sure it works, the heir might become king before this fires
			limit = { has_heir = no }
			add_stability = -3
		}
	}
	
	option = { # With Knights
		name = "sardinian_succession.6.b"
		trigger = { has_country_flag = got_kni_protection }
		KNI = {	country_event = { id = sardinian_succession.9 } }
		SQL = { country_event = { id = sardinian_succession.10 days = 1} }
	}
}

country_event = { # Chaos in Sardinia (Knights)
	id = sardinian_succession.7
	title = "sardinian_succession.7.t"
	desc = "sardinian_succession.7.d"
	picture = ANGRY_MOB_eventPicture
	
	is_triggered_only = yes
	
	option = { # We must restore order
		name = "sardinian_succession.7.a"
		ai_chance = { factor = 95 }
		declare_war_with_cb = {
			who = SAR
			casus_belli = cb_conquest
			war_goal_province = 127
		}
		if = { # Test this to make sure it works, the heir might become king before this fires
			limit = { SAR = { has_heir = no } }
			127 = { change_controller = KNI }
		}
	}
	
	option = { # There is nothing we can do
		name = "sardinian_succession.7.b"
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0
				ruler_has_personality = greedy_personality
			}
			modifier = {
				factor = 0
				ruler_has_personality = conqueror_personality
			}
			modifier = {
				factor = 25
				is_at_war = yes
			}
		}
		add_prestige = -20
		add_devotion = -10
	}
}

country_event = { # Chaos in Sardinia (Siqily)
	id = sardinian_succession.8
	title = "sardinian_succession.8.t"
	desc = "sardinian_succession.8.d"
	picture = ANGRY_MOB_eventPicture
	
	is_triggered_only = yes
	
	option = { # We must retake the island
		name = "sardinian_succession.8.a"
		ai_chance = { factor = 95 }
		declare_war_with_cb = {
			who = SAR
			casus_belli = cb_conquest
			war_goal_province = 2986
		}
		if = { # Test this to make sure it works, the heir might become king before this fires
			limit = { SAR = { has_heir = no } }
			2986 = { change_controller = SQL }
		}
	}
	
	option = { # There is nothing we can do
		name = "sardinian_succession.8.b"
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0
				ruler_has_personality = greedy_personality
			}
			modifier = {
				factor = 0
				ruler_has_personality = conqueror_personality
			}
			modifier = {
				factor = 25
				is_at_war = yes
			}
		}
		add_prestige = -20
		add_legitimacy = -10
	}
}

country_event = { # The death of Guglielmo (Knights)
	id = sardinian_succession.9
	title = "sardinian_succession.9.t"
	desc = "sardinian_succession.9.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "sardinian_succession.9.a"
		create_march = SAR
	}
}

country_event = { # The Knights interfere in Sardinia
	id = sardinian_succession.10
	title = "sardinian_succession.10.t"
	desc = "sardinian_succession.10.d"
	picture = RELIGIOUS_WARS_eventPicture
	
	is_triggered_only = yes
	
	option = { # We must invade!
		name = "sardinian_succession.10.a"
		ai_chance = { factor = 95 }
		declare_war_with_cb = {
			who = KNI
			casus_belli = cb_conquest
			war_goal_province = 2986
		}
	}
	option = { # They are too strong
		name = "sardinian_succession.10.b"
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0
				ruler_has_personality = greedy_personality
			}
			modifier = {
				factor = 0
				ruler_has_personality = conqueror_personality
			}
			modifier = {
				factor = 25
				is_at_war = yes
			}
		}
		add_prestige = -20
		add_legitimacy = -10
	}
}